version: "2"
services:

    lb:
      restart: always
      image: dockercloud/haproxy:1.3
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
      ports:
        - 85:80
      links:
        - nginx
        - php


    nginx:
      restart: always
      image: nginx
      volumes:
         - ./app/realestate.co.rw/website_config/instances/cp/assets:/usr/share/nginx/html/assets/cp
         - ./app/realestate.co.rw/portal_config/instances/listingpresentations/assets:/usr/share/nginx/html/assets/listingpresentations
         - ./app/realestate.co.rw/website_config/themes/default_rw_rw/assets:/usr/share/nginx/html/assets/default_rw_rw
         - ./app/realestate.co.rw/portal_config/themes/dev_rw/assets:/usr/share/nginx/html/assets/dev_rw
         - ./app/realestate.co.rw/controlpanel/public/assets:/usr/share/nginx/html/assets
      environment:
        - VIRTUAL_HOST_WEIGHT=2
        - VIRTUAL_HOST=*/assets/*

    php:
      restart: always
      build: ./build/php
      volumes:
        - ./app:/var/www/html
      links:
        - mysql
      environment:
        - VIRTUAL_HOST_WEIGHT=1
        - VIRTUAL_HOST=*
        

    mysql:
      restart: always
      image: mysql:5.6
      container_name: mysql
      ports:
        - "13306:3306"
      volumes:
        - ./build/mysql/initdb:/docker-entrypoint-initdb.d
        - ./database:/var/lib/mysql
  #      - ./build/mysql/sh:/build/mysql/sh #comment or remove this line when run on linux(native) os
      environment:
        - MYSQL_DATABASE=world
        - MYSQL_ROOT_PASSWORD=password

    pma:
      restart: always
      image: phpmyadmin/phpmyadmin
      links:
       - mysql:db
      ports:
        - 8080:80
